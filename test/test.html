<script src="node_modules/requirejs/require.js"></script>
<script>
  // Issues so far (so that I don't forget by Monday):
  // - Rollup-OMT-produced files are not compatible with Require.js, because they don't use anonymous `define` for the entry point.
  // - If I patch the entry point to use anonymous define, it becomes loadable by Require.js but not by Worker which uses OMT's simpler loader.
  // - `new Worker(new URL(...))` gets transformed into `new Worker('./some-file.js')` which doesn't work right in nested dirs. We need to preserve the `new URL(...)` form and only replace the first argument, so that URL is still dynamically computed at runtime.

  require(['pkg/test.rollup.js/index.js', 'pkg/test.webpack.js/index'], (rollupRunner, webpackRunner) => {
    Promise.all([
      // skip until upstream is fixed
      // rollupRunner.runTest(),
      webpackRunner.runTest()
    ]).then(() => {
      console.log('Done');
      window.DONE = true;
    });
  });
</script>
